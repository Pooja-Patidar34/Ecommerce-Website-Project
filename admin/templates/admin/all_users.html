{% extends "admin/base.html" %}
{% load static %}

{% block content %}
<div class="content-wrapper">
  <!-- Page header -->


  <!-- Main content -->
  <section class="content">
    <div class="card">
      <div class="card-header bg-primary text-white">
        <h3 class="card-title">All Users List</h3>

      </div>
      <div class="card-body table-responsive">
        <table id="usersTable" class="table table-striped table-bordered align-middle text-center">
          {% if messages %}
          <div class="container mt-2">
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {% endfor %}
          </div>
          {% endif %}
          <thead class="">
            <tr>
              <th>ID</th>
              <th>First Name</th>
              <th>Last Name</th>
              <th>Email</th>
              <th>Username</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for u in users %}
            <tr>
              <td>{{ u.id }}</td>
              {% if u.first_name %}
                <td>{{ u.first_name }}</td>
              {% else %}
                <td>-</td>
              {% endif %}
              {% if u.last_name %}
              <td>{{u.last_name}}</td>
              {% else %}
              <td>-</td>
              {% endif %}
              {% if u.email %}
                <td>{{ u.email }}</td>
              {% else %}
                <td>-</td>
              {% endif %}
            
              <td>{{ u.username }}</td>
              <td>
                <div class="dropdown">
                  <button class="btn btn-sm btn-secondary dropdown-toggle" type="button" id="actionMenu{{ u.id }}"
                    data-bs-toggle="dropdown" aria-expanded="false">
                    Actions
                  </button>
                  <ul class="dropdown-menu" aria-labelledby="actionMenu{{ u.id }}">
                    <li><a class="dropdown-item" href="#">‚úèÔ∏è Edit</a></li>
                    {% if u.is_active %}
                    <li>
                      <a href="#" class="dropdown-item text-warning" data-bs-toggle="modal"
                        data-bs-target="#confirmActionModal" data-url="{% url 'block_user' u.id %}"
                        data-username="{{ u.username }}" data-action="block">
                        üö´ Block
                      </a>
                    </li>
                    {% else %}
                    <li>
                      <a href="#" class="dropdown-item text-success" data-bs-toggle="modal"
                        data-bs-target="#confirmActionModal" data-url="{% url 'unblock_user' u.id %}"
                        data-username="{{ u.username }}" data-action="unblock">
                        ‚úÖ UnBlock
                      </a>
                    </li>
                    {% endif %}
                  </ul>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
       </table>
       <!-- Reusable Modal (only one, outside the loop) -->
        <div class="modal fade" id="confirmActionModal" tabindex="-1" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="confirmActionTitle"></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body" id="confirmActionBody"></div>
              <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <a id="confirmActionBtn" href="#" class="btn"></a>
              </div>
            </div>
          </div>
        </div>
         </div>
    </div>
  </section>
</div>
<!-- Auto remove after 10 seconds -->
<script>
  setTimeout(() => {
    let alerts = document.querySelectorAll('.alert');
    alerts.forEach(alert => {
      let bsAlert = new bootstrap.Alert(alert);
      bsAlert.close();
    });
  }, 10000); // 10000ms = 10 seconds

  document.addEventListener('DOMContentLoaded', function () {
    var confirmModal = document.getElementById('confirmActionModal');
    confirmModal.addEventListener('show.bs.modal', function (event) {
      var button = event.relatedTarget;
      var url = button.getAttribute('data-url');
      var username = button.getAttribute('data-username');
      var action = button.getAttribute('data-action');

      var title = confirmModal.querySelector('#confirmActionTitle');
      var body = confirmModal.querySelector('#confirmActionBody');
      var confirmBtn = confirmModal.querySelector('#confirmActionBtn');

      if (action === 'block') {
        title.textContent = 'Confirm Suspend';
        body.innerHTML = `‚ö†Ô∏è Are you sure you want to Suspend <b>${username}</b>?`;
        confirmBtn.textContent = 'Yes, Suspend';
        confirmBtn.className = 'btn btn-danger';
      } else {
        title.textContent = 'Confirm Suspend';
        body.innerHTML = `‚úÖ Are you sure you want to Unsuspend <b>${username}</b>?`;
        confirmBtn.textContent = 'Yes, Unsuspend';
        confirmBtn.className = 'btn btn-success';
      }
      confirmBtn.setAttribute('href', url);
    });
  });
</script> 
{% endblock %}